name: pytesthw1
on: [push]

jobs:
  build:

      runs-on: ubuntu-latest
      strategy:
        matrix:
          python-version: ["3.13"]


      steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          
      - name: Test with pytest
        run: |
          pip install pytest pytest-cov
          pytest test.py --doctest-modules --junitxml=junit/test-results.xml --cov=com --cov-report=xml --cov-report=html
     
      - name: Update README.md with badges
        run: |
          pylint_badge=$(cat post_traces/pylint_badge.txt)
          bandit_badge=$(cat post_traces/bandit_badge.txt)
          autopep8_badge=$(cat post_traces/autopep8_badge.txt)
        
        # Replace the badges in the README.md file
          sed -i "s|!\[Pylint\](.*)|![Pylint]($pylint_badge)|" README.md
          sed -i "s|!\[Bandit\](.*)|![Bandit]($bandit_badge)|" README.md
          sed -i "s|!\[Autopep8\](.*)|![Autopep8]($autopep8_badge)|" README.md
        
      - name: Commit and push updated README.md
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add README.md
          git commit -m "Update badges in README.md"
          git push

    
